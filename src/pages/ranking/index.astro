---
import BaseLayout from "@/layouts/base.astro";
import { getEntry } from "astro:content";

const entry = await getEntry("views", "ranking");

if (!entry) {
  return Astro.redirect("/404");
}

// 週間ランキングのサンプルデータ（後でWordPressから取得）
const weeklyRanking = [
  {
    rank: 1,
    title: "宮崎県内企業のDX成功事例：製造業A社の生産性向上",
    excerpt: "従業員30名の製造業がデジタル化により生産性を40%向上させた事例",
    category: "dx",
    views: 5420,
    shares: 85,
    comments: 23,
    score: 5850,
    slug: "dx-success-manufacturing",
    published_date: "2024-01-10",
    author: "田中太郎"
  },
  {
    rank: 2,
    title: "ChatGPTで業務効率化：宮崎の中小企業活用事例5選",
    excerpt: "宮崎県内の中小企業がChatGPTを活用して業務効率化を実現した具体的な事例",
    category: "ai-business",
    views: 4890,
    shares: 72,
    comments: 19,
    score: 5200,
    slug: "chatgpt-sme-cases",
    published_date: "2024-01-08",
    author: "佐藤花子"
  },
  {
    rank: 3,
    title: "宮崎市のITスタートアップが注目される理由",
    excerpt: "人口減少地域でありながら、なぜ宮崎市でITスタートアップが生まれているのか",
    category: "local-tech",
    views: 3650,
    shares: 58,
    comments: 31,
    score: 4500,
    slug: "miyazaki-startup-ecosystem",
    published_date: "2024-01-12",
    author: "山田次郎"
  }
];

const calculateScore = (views: number, shares: number, comments: number) => {
  return views * 1 + shares * 3 + comments * 5;
};

const getCategoryName = (category: string) => {
  const categoryMap = {
    'dx': 'DX推進',
    'ai-business': 'AIビジネス',
    'local-tech': '地域テック',
    'management-it': '経営×IT'
  };
  return categoryMap[category] || category;
};

const getCategoryColor = (category: string) => {
  const colorMap = {
    'dx': 'bg-blue-100 text-blue-800',
    'ai-business': 'bg-green-100 text-green-800',
    'local-tech': 'bg-yellow-100 text-yellow-800',
    'management-it': 'bg-purple-100 text-purple-800'
  };
  return colorMap[category] || 'bg-gray-100 text-gray-800';
};
---

<BaseLayout entry={entry}>
  <main class="container mx-auto px-4 py-8">
    <header class="text-center mb-12">
      <h1 class="text-4xl font-bold text-gray-900 dark:text-white mb-4">
        週間ランキング
      </h1>
      <p class="text-lg text-gray-600 dark:text-gray-300 max-w-2xl mx-auto mb-6">
        今週最も読まれた記事をランキング形式でお届け
      </p>
      <div class="text-sm text-gray-500">
        集計期間: {new Date(Date.now() - 7 * 24 * 60 * 60 * 1000).toLocaleDateString('ja-JP')} - {new Date().toLocaleDateString('ja-JP')}
      </div>
    </header>

    <!-- ランキング算出方法の説明 -->
    <div class="bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-lg p-4 mb-8">
      <h2 class="text-lg font-semibold text-blue-900 dark:text-blue-100 mb-2">
        ランキング算出方法
      </h2>
      <p class="text-blue-800 dark:text-blue-200 text-sm">
        ページビュー数 × 1 + SNSシェア数 × 3 + コメント数 × 5 でスコアを算出
      </p>
    </div>

    <!-- ランキングリスト -->
    <div class="space-y-6">
      {weeklyRanking.map((article, index) => (
        <article class="bg-white dark:bg-gray-800 rounded-lg shadow-lg p-6 border-l-4 border-primary">
          <div class="flex items-start justify-between">
            <!-- ランキング番号 -->
            <div class="flex-shrink-0 mr-6">
              <div class={`w-12 h-12 rounded-full flex items-center justify-center text-2xl font-bold text-white ${
                article.rank === 1 ? 'bg-yellow-500' : 
                article.rank === 2 ? 'bg-gray-400' : 
                article.rank === 3 ? 'bg-amber-600' : 'bg-blue-500'
              }`}>
                {article.rank}
              </div>
            </div>
            
            <!-- 記事情報 -->
            <div class="flex-grow">
              <div class="flex items-center gap-3 mb-3">
                <span class={`px-2 py-1 rounded-full text-xs font-medium ${getCategoryColor(article.category)}`}>
                  {getCategoryName(article.category)}
                </span>
                <span class="text-sm text-gray-500">
                  {new Date(article.published_date).toLocaleDateString('ja-JP')}
                </span>
                <span class="text-sm text-gray-500">
                  by {article.author}
                </span>
              </div>
              
              <h2 class="text-xl font-bold text-gray-900 dark:text-white mb-3 hover:text-primary">
                <a href={`/articles/${article.slug}`}>
                  {article.title}
                </a>
              </h2>
              
              <p class="text-gray-600 dark:text-gray-300 mb-4">
                {article.excerpt}
              </p>
              
              <!-- 統計情報 -->
              <div class="flex items-center justify-between">
                <div class="flex items-center gap-6 text-sm text-gray-500">
                  <div class="flex items-center">
                    <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"></path>
                    </svg>
                    {article.views.toLocaleString()}
                  </div>
                  <div class="flex items-center">
                    <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8.684 13.342C8.886 12.938 9 12.482 9 12c0-.482-.114-.938-.316-1.342m0 2.684a3 3 0 110-2.684m0 2.684l6.632 3.316m-6.632-6l6.632-3.316m0 0a3 3 0 105.367-2.684 3 3 0 00-5.367 2.684zm0 9.316a3 3 0 105.367 2.684 3 3 0 00-5.367-2.684z"></path>
                    </svg>
                    {article.shares}
                  </div>
                  <div class="flex items-center">
                    <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"></path>
                    </svg>
                    {article.comments}
                  </div>
                </div>
                
                <div class="text-right">
                  <div class="text-lg font-bold text-primary">
                    {article.score.toLocaleString()}
                  </div>
                  <div class="text-xs text-gray-500">
                    スコア
                  </div>
                </div>
              </div>
            </div>
          </div>
        </article>
      ))}
    </div>
    
    <!-- 過去のランキング -->
    <div class="text-center mt-12">
      <h2 class="text-2xl font-bold text-gray-900 dark:text-white mb-6">
        過去のランキング
      </h2>
      <div class="grid md:grid-cols-3 gap-4">
        <a href="/ranking/2024-01-01" class="block bg-gray-50 dark:bg-gray-800 p-4 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors">
          <div class="font-semibold">先週のランキング</div>
          <div class="text-sm text-gray-500">2024/1/1 - 2024/1/7</div>
        </a>
        <a href="/ranking/2023-12-25" class="block bg-gray-50 dark:bg-gray-800 p-4 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors">
          <div class="font-semibold">先々週のランキング</div>
          <div class="text-sm text-gray-500">2023/12/25 - 2023/12/31</div>
        </a>
        <a href="/ranking/archive" class="block bg-gray-50 dark:bg-gray-800 p-4 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors">
          <div class="font-semibold">アーカイブ</div>
          <div class="text-sm text-gray-500">過去の全ランキング</div>
        </a>
      </div>
    </div>
  </main>
</BaseLayout>