---
import AuthorCard from "@/components/cards/authorCard.astro";
import HeaderSection from "./headerSection.astro";
import { authorsHandler } from "@/lib/handlers/authors";

const authors = authorsHandler.limitAurhors(6);
---

<section class="container py-12" data-pagefind-ignore="all">
  <HeaderSection title="Authors" />
  <ul
    role="list"
    class="grid grid-cols-2 gap-x-4 gap-y-8 sm:grid-cols-3 lg:grid-cols-6 sm:gap-y-12 xl:col-span-2 mt-4"
  >
    {authors.map((author) => <AuthorCard author={author} />)}
  </ul>
</section>

<!-- Author Modal -->
<div id="authorModal" class="fixed inset-0 bg-black bg-opacity-50 hidden z-50 flex items-center justify-center">
  <div class="bg-white dark:bg-gray-800 rounded-lg p-6 max-w-md w-full mx-4 relative">
    <button 
      onclick="closeAuthorModal()" 
      class="absolute top-4 right-4 text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200"
    >
      <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
      </svg>
    </button>
    <div id="modalContent">
      <!-- Content will be inserted here -->
    </div>
  </div>
</div>

<script>
  function openAuthorModal(id, name, job, bio, socialData) {
    const modal = document.getElementById('authorModal');
    const content = document.getElementById('modalContent');
    
    let social = [];
    try {
      social = JSON.parse(socialData.replace(/&quot;/g, '"'));
    } catch (e) {
      social = [];
    }
    
    const socialLinks = social.map(link => 
      `<a href="${link.url}" target="_blank" rel="noopener" class="inline-flex items-center px-3 py-2 bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 rounded-md text-sm hover:bg-gray-200 dark:hover:bg-gray-600 transition-colors">${link.name}</a>`
    ).join(' ');
    
    content.innerHTML = `
      <h3 class="text-xl font-bold text-gray-900 dark:text-white mb-2">${name}</h3>
      <p class="text-sm text-primary dark:text-secondary mb-4">${job}</p>
      <p class="text-gray-700 dark:text-gray-300 leading-relaxed mb-4">${bio}</p>
      ${socialLinks ? `<div class="flex gap-2 flex-wrap">${socialLinks}</div>` : ''}
    `;
    
    modal.classList.remove('hidden');
    document.body.style.overflow = 'hidden';
  }
  
  function closeAuthorModal() {
    const modal = document.getElementById('authorModal');
    modal.classList.add('hidden');
    document.body.style.overflow = 'auto';
  }
  
  // Close modal when clicking outside
  document.getElementById('authorModal').addEventListener('click', function(e) {
    if (e.target === this) {
      closeAuthorModal();
    }
  });
  
  // Close modal with Escape key
  document.addEventListener('keydown', function(e) {
    if (e.key === 'Escape') {
      closeAuthorModal();
    }
  });
</script>
